import{x as J,A as r,T as F,B as $,C as Q,D as W,o as l,F as s,aC as X,H as Y,am as U,b4 as Z,K as ee,J as P,O as o,al as ae,aE as le,aF as te,P as B,b3 as oe,an as se,aG as re,L as ne,ag as ue}from"./index-89021e36.js";import{c as ie,a as D,b as de,f as ce,u as me,d,V as pe}from"./vee-validate.esm-6c01c182.js";import{V as ge}from"./VContainer-54c5c76a.js";import{V as ve,a as q}from"./VRow-1c82926f.js";import{V as be,a as Ve}from"./VSwitch-8a3e4c93.js";import{V as fe}from"./VTextarea-90fc25fe.js";import"./_commonjsHelpers-39b5b250.js";const ye=ue("h1",{class:"text-center"},"商品管理",-1),Pe={__name:"UserProductsView",setup(we){const w=J(),h=r(5),c=r([{key:"name",order:"asc"}]),m=r(1),k=r([]),E=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"說明",align:"center",sortable:!1,key:"description"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],x=r(!1),M=r(0),p=r(""),A=()=>{m.value=1,n()},n=async()=>{x.value=!0;try{const{data:t}=await F.get("/products/user",{params:{page:m.value,itemsPerPage:h.value,sortBy:c.value[0].key,sortOrder:c.value[0].order,search:p.value}});k.value.splice(0,k.value.length,...t.result.data),M.value=t.result.count}catch(t){w({text:t.response.data.message,showCloseButton:!1,snackbarProps:{timeout:3e3,color:"error",location:"bottom"}})}x.value=!1};n();const K=t=>{u.value=t._id,v.value.value=t.name,b.value.value=t.price,V.value.value=t.description,f.value.value=t.category,y.value.value=t.sell,g.value=!0},g=r(!1),u=r(""),L=async t=>{u.value=t._id;const e=new FormData;e.append("sell",!t.sell),await F.patch("/products/"+u.value,e)},T=()=>{g.value=!1,H(),_.value.deleteFileRecord()},z=["漫畫","插畫","素材","音樂","3D模型","遊戲","公仔"],N=ie({name:D().required("缺少名稱"),price:de().typeError("價格錯誤").required("缺少價格").min(0,"價格錯誤"),description:D().required("缺少說明"),category:D().required("缺少分類").test("isCategory",t=>["漫畫","插畫","素材","音樂","3D模型","遊戲","公仔"].includes(t)),sell:ce()}),{handleSubmit:j,isSubmitting:C,resetForm:H}=me({validationSchema:N,initialValues:{name:"",price:0,description:"",category:"",sell:!1}}),v=d("name"),b=d("price"),V=d("description"),f=d("category"),y=d("sell"),i=r([]),I=r([]),_=r(null),O=j(async t=>{if(!(u.value.length===0&&i.value.length===0))try{const e=new FormData;e.append("name",t.name),e.append("price",t.price),e.append("description",t.description),e.append("category",t.category),e.append("sell",t.sell),i.value.length>0&&e.append("image",i.value[0].file),u.value.length>0&&await F.patch("/products/"+u.value,e),w({text:"修改成功",showCloseButton:!1,snackbarProps:{timeout:3e3,color:"success",location:"bottom"}}),T(),n()}catch(e){w({text:e.response.data.message,showCloseButton:!1,snackbarProps:{timeout:3e3,color:"error",location:"bottom"}})}});return(t,e)=>{const R=$("VDataTableServer"),G=$("VueFileAgent");return Q(),W(Y,null,[l(ge,{class:"overflow-y-auto pa-10"},{default:s(()=>[l(ve,{class:"elevation-3 rounded-lg"},{default:s(()=>[l(q,{class:"bg-indigo",cols:"12"},{default:s(()=>[ye]),_:1}),l(q,{class:"bg-light-blue-lighten-5",cols:"12"},{default:s(()=>[l(R,{class:"tableDescFix data-table","items-per-page":h.value,"onUpdate:itemsPerPage":[e[1]||(e[1]=a=>h.value=a),n],"sort-by":c.value,"onUpdate:sortBy":[e[2]||(e[2]=a=>c.value=a),n],page:m.value,"onUpdate:page":[e[3]||(e[3]=a=>m.value=a),n],items:k.value,headers:E,loading:x.value,"items-length":M.value,hover:"",search:p.value},{top:s(()=>[l(U,{class:"w-50 ml-5",variant:"underlined",placeholder:"請輸入詳細資料","prepend-inner-icon":"mdi-magnify","onClick:prependInner":A,modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),onKeydown:Z(A,["enter"]),clearable:""},null,8,["modelValue","onKeydown"])]),"item.image":s(({item:a})=>[l(ee,{class:"rounded mx-auto",src:a.raw.image,width:"150","aspect-ratio":1,cover:""},null,8,["src"])]),"item.sell":s(({item:a})=>[l(be,{color:"success",density:"compact",modelValue:a.raw.sell,"onUpdate:modelValue":S=>a.raw.sell=S,onClick:S=>L(a.raw)},null,8,["modelValue","onUpdate:modelValue","onClick"])]),"item.edit":s(({item:a})=>[l(P,{variant:"text",icon:"mdi-square-edit-outline",onClick:S=>K(a.raw)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),l(X,{persistent:"",scrollable:"",width:"500",modelValue:g.value,"onUpdate:modelValue":e[11]||(e[11]=a=>g.value=a)},{default:s(()=>[l(pe,{disabled:o(C),onSubmit:ae(o(O),["prevent"])},{default:s(()=>[l(le,null,{default:s(()=>[l(te,{class:"mb-5 bg-blue-lighten-2 text-white font-weight-bold"},{default:s(()=>[B("管理商品")]),_:1}),l(oe,{style:{height:"400px"}},{default:s(()=>[l(U,{label:"名稱",modelValue:o(v).value.value,"onUpdate:modelValue":e[4]||(e[4]=a=>o(v).value.value=a),"error-messages":o(v).errorMessage.value,variant:"solo-filled"},null,8,["modelValue","error-messages"]),l(U,{label:"價格",modelValue:o(b).value.value,"onUpdate:modelValue":e[5]||(e[5]=a=>o(b).value.value=a),modelModifiers:{number:!0},"error-messages":o(b).errorMessage.value,type:"number",variant:"solo-filled"},null,8,["modelValue","error-messages"]),l(fe,{label:"說明",modelValue:o(V).value.value,"onUpdate:modelValue":e[6]||(e[6]=a=>o(V).value.value=a),"error-messages":o(V).errorMessage.value,variant:"solo-filled"},null,8,["modelValue","error-messages"]),l(se,{chips:"",label:"類別",modelValue:o(f).value.value,"onUpdate:modelValue":e[7]||(e[7]=a=>o(f).value.value=a),"error-messages":o(f).errorMessage.value,items:z,variant:"solo-filled",hint:"請選擇分類"},null,8,["modelValue","error-messages"]),l(Ve,{label:"上架",modelValue:o(y).value.value,"onUpdate:modelValue":e[8]||(e[8]=a=>o(y).value.value=a),"error-messages":o(y).errorMessage.value,color:"blue"},null,8,["modelValue","error-messages"]),l(G,{modelValue:i.value,"onUpdate:modelValue":e[9]||(e[9]=a=>i.value=a),"raw-model-value":I.value,"onUpdate:rawModelValue":e[10]||(e[10]=a=>I.value=a),"max-files":1,"max-size":"1MB",accept:"image/jpg, image/jpeg, image/png",multiple:!1,"error-text":{type:"檔案格式錯誤",size:"檔案太大"},"help-text":"選擇檔案或拖放到這裡","thumbnail-size":1200,deletable:"",ref_key:"fileAgent",ref:_},null,8,["modelValue","raw-model-value"])]),_:1}),l(re,null,{default:s(()=>[l(ne),l(P,{type:"submit",color:"success",variant:"tonal",loading:o(C)},{default:s(()=>[B("確認")]),_:1},8,["loading"]),l(P,{color:"error",variant:"tonal",onClick:T,loading:o(C)},{default:s(()=>[B("取消")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};export{Pe as default};
