import{x as Q,A as r,T as F,B as q,C as W,D as X,o as l,F as s,aC as Y,H as Z,af as ee,am as P,b4 as ae,ag as K,U as le,K as te,J as B,O as o,al as oe,aE as se,aF as re,P as D,b3 as ne,an as ue,aG as ie,L as de}from"./index-acf387ef.js";import{c as me,a as M,b as ce,f as pe,u as ve,d as m,V as ge}from"./vee-validate.esm-ec558189.js";import{V as Ve}from"./VContainer-09275625.js";import{V as be,a as E}from"./VRow-6d3d5382.js";import{V as fe,a as ye}from"./VSwitch-ce278a9e.js";import{V as we}from"./VTextarea-f7f3fc75.js";import"./_commonjsHelpers-39b5b250.js";const ke=K("h1",{class:"text-center"},"商品管理",-1),De={__name:"ProductsView",setup(he){const k=Q(),h=r(5),c=r([{key:"name",order:"asc"}]),p=r(1),x=r([]),L=[{title:"會員",align:"center",sortable:!1,key:"users"},{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"說明",align:"center",sortable:!1,key:"description"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],C=r(!1),A=r(0),v=r(""),T=()=>{p.value=1,u()},u=async()=>{var t,e;C.value=!0;try{const{data:n}=await F.get("/products/all",{params:{page:p.value,itemsPerPage:h.value,sortBy:((t=c.value[0])==null?void 0:t.key)||"_id",sortOrder:((e=c.value[0])==null?void 0:e.order)||"asc",search:v.value}});x.value.splice(0,x.value.length,...n.result.data),A.value=n.result.count}catch(n){console.log(n),k({text:n.response.data.message,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}C.value=!1};u();const z=t=>{i.value=t._id,V.value.value=t.name,b.value.value=t.price,f.value.value=t.description,y.value.value=t.category,w.value.value=t.sell,g.value=!0},g=r(!1),i=r(""),N=async t=>{i.value=t._id;const e=new FormData;e.append("sell",!t.sell),await F.patch("/products/"+i.value,e)},I=()=>{g.value=!1,R(),$.value.deleteFileRecord()},j=["漫畫","插畫","素材","音樂","3D模型","遊戲","公仔"],H=me({name:M().required("缺少名稱"),price:ce().typeError("價格錯誤").required("缺少價格").min(0,"價格錯誤"),description:M().required("缺少說明"),category:M().required("缺少分類").test("isCategory",t=>["漫畫","插畫","素材","音樂","3D模型","遊戲","公仔"].includes(t)),sell:pe()}),{handleSubmit:O,isSubmitting:S,resetForm:R}=ve({validationSchema:H,initialValues:{name:"",price:0,description:"",category:"",sell:!1}}),V=m("name"),b=m("price"),f=m("description"),y=m("category"),w=m("sell"),d=r([]),_=r([]),$=r(null),G=O(async t=>{if(!(i.value.length===0&&d.value.length===0))try{const e=new FormData;e.append("name",t.name),e.append("price",t.price),e.append("description",t.description),e.append("category",t.category),e.append("sell",t.sell),d.value.length>0&&e.append("image",d.value[0].file),i.value.length>0&&await F.patch("/products/"+i.value,e),k({text:"修改成功",showCloseButton:!1,snackbarProps:{timeout:3e3,color:"success",location:"bottom"}}),I(),u()}catch(e){k({text:e.response.data.message,showCloseButton:!1,snackbarProps:{timeout:3e3,color:"error",location:"bottom"}})}});return(t,e)=>{const n=q("VDataTableServer"),J=q("VueFileAgent");return W(),X(Z,null,[l(Ve,null,{default:s(()=>[l(be,null,{default:s(()=>[l(E,{cols:"12"},{default:s(()=>[ke,l(ee)]),_:1}),l(E,{cols:"12"}),l(n,{"items-per-page":h.value,"onUpdate:itemsPerPage":[e[1]||(e[1]=a=>h.value=a),u],"sort-by":c.value,"onUpdate:sortBy":[e[2]||(e[2]=a=>c.value=a),u],page:p.value,"onUpdate:page":[e[3]||(e[3]=a=>p.value=a),u],items:x.value,headers:L,loading:C.value,"items-length":A.value,hover:"",search:v.value},{top:s(()=>[l(P,{variant:"solo-filled",placeholder:"請輸入詳細資料","prepend-inner-icon":"mdi-magnify","onClick:prependInner":T,modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a),onKeydown:ae(T,["enter"]),clearable:""},null,8,["modelValue","onKeydown"])]),"item.user":s(({item:a})=>[K("text",null,le(a.raw.user),1)]),"item.image":s(({item:a})=>[l(te,{src:a.raw.image,"min-width":150},null,8,["src"])]),"item.sell":s(({item:a})=>[l(fe,{color:"success",density:"compact",modelValue:a.raw.sell,"onUpdate:modelValue":U=>a.raw.sell=U,onClick:U=>N(a.raw)},null,8,["modelValue","onUpdate:modelValue","onClick"])]),"item.edit":s(({item:a})=>[l(B,{variant:"text",icon:"mdi-square-edit-outline",onClick:U=>z(a.raw)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1}),l(Y,{persistent:"",scrollable:"",width:"500",modelValue:g.value,"onUpdate:modelValue":e[11]||(e[11]=a=>g.value=a)},{default:s(()=>[l(ge,{disabled:o(S),onSubmit:oe(o(G),["prevent"])},{default:s(()=>[l(se,null,{default:s(()=>[l(re,{class:"mb-5 bg-blue-lighten-2 text-white font-weight-bold"},{default:s(()=>[D("管理商品")]),_:1}),l(ne,{style:{height:"400px"}},{default:s(()=>[l(P,{label:"名稱",modelValue:o(V).value.value,"onUpdate:modelValue":e[4]||(e[4]=a=>o(V).value.value=a),"error-messages":o(V).errorMessage.value,variant:"solo-filled"},null,8,["modelValue","error-messages"]),l(P,{label:"價格",modelValue:o(b).value.value,"onUpdate:modelValue":e[5]||(e[5]=a=>o(b).value.value=a),modelModifiers:{number:!0},"error-messages":o(b).errorMessage.value,type:"number",variant:"solo-filled"},null,8,["modelValue","error-messages"]),l(we,{label:"說明",modelValue:o(f).value.value,"onUpdate:modelValue":e[6]||(e[6]=a=>o(f).value.value=a),"error-messages":o(f).errorMessage.value,variant:"solo-filled"},null,8,["modelValue","error-messages"]),l(ue,{chips:"",label:"類別",modelValue:o(y).value.value,"onUpdate:modelValue":e[7]||(e[7]=a=>o(y).value.value=a),"error-messages":o(y).errorMessage.value,items:j,variant:"solo-filled",hint:"請選擇分類"},null,8,["modelValue","error-messages"]),l(ye,{label:"上架",modelValue:o(w).value.value,"onUpdate:modelValue":e[8]||(e[8]=a=>o(w).value.value=a),"error-messages":o(w).errorMessage.value,color:"blue"},null,8,["modelValue","error-messages"]),l(J,{modelValue:d.value,"onUpdate:modelValue":e[9]||(e[9]=a=>d.value=a),"raw-model-value":_.value,"onUpdate:rawModelValue":e[10]||(e[10]=a=>_.value=a),"max-files":1,"max-size":"1MB",accept:"image/jpg, image/jpeg, image/png",multiple:!1,"error-text":{type:"檔案格式錯誤",size:"檔案太大"},"help-text":"選擇檔案或拖放到這裡","thumbnail-size":1200,deletable:"",ref_key:"fileAgent",ref:$},null,8,["modelValue","raw-model-value"])]),_:1}),l(ie,null,{default:s(()=>[l(de),l(B,{type:"submit",color:"success",variant:"tonal",loading:o(S)},{default:s(()=>[D("確認")]),_:1},8,["loading"]),l(B,{color:"error",variant:"tonal",onClick:I,loading:o(S)},{default:s(()=>[D("取消")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};export{De as default};
