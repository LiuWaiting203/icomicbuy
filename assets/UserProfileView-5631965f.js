import{r as I,A as i,x as G,T as F,B as H,C as y,D as J,o as e,F as t,aC as K,H as O,aE as S,aF as U,P as n,ag as u,K as R,O as l,J as p,V as _,U as f,af as x,al as L,b3 as c,E as z,am as A,G as D}from"./index-acf387ef.js";import{v as Q}from"./index-6fc8fe85.js";import{c as W,a as h,u as X,d as E,V as Y}from"./vee-validate.esm-ec558189.js";import{V as Z}from"./VContainer-09275625.js";import{V as P,a as w}from"./VRow-6d3d5382.js";import"./_commonjsHelpers-39b5b250.js";const ee={class:"d-flex justify-center align-center flex-column",style:{position:"relative"}},ae={class:"text-h5 mt-5 font-weight-bold"},te={class:"text-grey-darken-2"},le={class:"text-grey-darken-2"},se={class:"text-grey-darken-2"},oe={class:"text-grey-darken-2"},pe={__name:"UserProfileView",setup(ne){const r=I(),v=i(!1),b=i(!1),d=i(!1),g=G(),m=i([]),C=i([]),$=i(null),M=W({name:h().required("暱稱必填").max(10,"暱稱最多 10 個字"),email:h().required("信箱必填").test("isEmail","信箱格式錯誤",o=>Q.isEmail(o)),avatar:h()}),{handleSubmit:N,isSubmitting:T}=X({validationSchema:M}),V=E("name"),k=E("email"),B=N(async o=>{try{const a=new FormData;console.log(o),a.append("name",o.name),a.append("email",o.email),await F.patch("/users/edit",a),g({text:"修改成功",showCloseButton:!1,snackbarProps:{timeout:3e3,color:"success",location:"bottom"}}),r.name=o.name,r.email=o.email}catch(a){console.log(a),g({text:a.response.data.message,showCloseButton:!1,snackbarProps:{timeout:3e3,color:"error",location:"bottom"}})}}),j=async o=>{if(m.value.length!==0)try{const a=new FormData;m.value.length>0&&a.append("image",m.value[0].file),await F.patch("/users/edit",a),g({text:"修改成功",color:"success",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"success",position:"top"}}),d.value=!1}catch(a){g({text:a.response.data.message,color:"error",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"error",position:"top"}})}};return(o,a)=>{const q=H("VueFileAgent");return y(),J(O,null,[e(Z,null,{default:t(()=>[e(P,null,{default:t(()=>[e(w,{cols:"12"},{default:t(()=>[e(S,null,{default:t(()=>[e(U,{class:"bg-blue text-h5 font-weight-bold text-center"},{default:t(()=>[n("個人資料修改及管理")]),_:1}),e(P,{"no-gutters":""},{default:t(()=>[e(w,{cols:"12",md:"4"},{default:t(()=>[u("div",ee,[e(R,{class:"mt-15 rounded-circle",src:l(r).avatar,width:"120","aspect-ratio":1,cover:""},null,8,["src"]),e(p,{class:"elevation-1 text-grey-lighten-1",icon:"mdi-pencil",size:"30",onClick:a[0]||(a[0]=s=>d.value=!d.value),style:{position:"absolute",top:"calc(50% + 40px)",right:"calc(50% - 50px)"}},{default:t(()=>[e(_,{icon:"mdi-pencil"})]),_:1}),u("text",ae,f(l(r).name),1)])]),_:1}),e(x,{vertical:""}),e(w,{cols:"12",md:"8"},{default:t(()=>[e(Y,{disabled:l(T),onSubmit:L(l(B),["prevent"])},{default:t(()=>[e(c,{class:"mt-5 text-h6 text-blue"},{default:t(()=>[n("帳號："),u("span",te,f(l(r).account),1)]),_:1}),e(x,{class:"text-black"}),e(c,{class:"text-h6 text-blue"},{default:t(()=>[n(" 暱稱："),u("span",le,f(l(r).name),1),e(p,{class:"ms-3 elevation-0 text-grey-lighten-3",size:"30",ripple:!1,onClick:a[1]||(a[1]=s=>v.value=!v.value)},{default:t(()=>[e(_,{icon:"mdi-pencil",size:"20"})]),_:1}),v.value?(y(),z(A,{key:0,class:"text-grey-darken-2 mt-4 w-50",type:"text",modelValue:l(V).value.value,"onUpdate:modelValue":a[2]||(a[2]=s=>l(V).value.value=s),"error-messages":l(V).errorMessage.value,variant:"outlined",density:"compact",label:"修改暱稱",placeholder:"請輸入暱稱","prepend-inner-icon":"mdi-account-circle",counter:"",maxlength:"10"},null,8,["modelValue","error-messages"])):D("",!0)]),_:1}),e(x,{class:"text-black"}),e(c,{class:"text-h6 text-blue"},{default:t(()=>[n("信箱："),u("span",se,f(l(r).email),1),e(p,{class:"ms-3 elevation-0 text-grey-lighten-3",size:"30",ripple:!1,onClick:a[3]||(a[3]=s=>b.value=!b.value)},{default:t(()=>[e(_,{icon:"mdi-pencil",size:"20"})]),_:1}),b.value?(y(),z(A,{key:0,class:"text-grey-darken-2 mt-4 w-50",type:"email",modelValue:l(k).value.value,"onUpdate:modelValue":a[4]||(a[4]=s=>l(k).value.value=s),"error-messages":l(k).errorMessage.value,variant:"outlined",density:"compact",label:"修改信箱地址",placeholder:"請輸入信箱","prepend-inner-icon":"mdi-mailbox"},null,8,["modelValue","error-messages"])):D("",!0)]),_:1}),e(x,{class:"text-black"}),e(c,{class:"text-h6 text-blue"},{default:t(()=>[n("喜歡的商品數量："),u("span",oe,f(l(r).likes),1)]),_:1}),e(x,{class:"text-black"}),e(c,{class:"d-flex"},{default:t(()=>[e(p,{class:"ms-auto",color:"primary",onClick:l(B)},{default:t(()=>[n("確認修改")]),_:1},8,["onClick"])]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(K,{modelValue:d.value,"onUpdate:modelValue":a[8]||(a[8]=s=>d.value=s),width:"500"},{default:t(()=>[e(S,null,{default:t(()=>[e(U,{class:"bg-cyan-darken-1 text-h5 font-weight-bold text-center"},{default:t(()=>[n("修改大頭貼")]),_:1}),e(c,{class:"text-subtitle-2"},{default:t(()=>[n("請上傳大頭貼"),e(q,{class:"vueUploadBox",modelValue:m.value,"onUpdate:modelValue":a[5]||(a[5]=s=>m.value=s),"raw-model-value":C.value,"onUpdate:rawModelValue":a[6]||(a[6]=s=>C.value=s),ref_key:"fileAgent",ref:$,compact:!0,"thumbnail-size":300,"max-files":1,"max-size":"1MB",multiple:!1,deletable:"",accept:"image/jpg, image/jpeg, image/png","help-text":"請選擇檔案或拖放到這裡","error-text":{type:"檔案格式錯誤",size:"檔案太大"}},null,8,["modelValue","raw-model-value"]),e(p,{class:"mt-5",color:"cyan-darken-3",onClick:a[7]||(a[7]=s=>j())},{default:t(()=>[n("上傳")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}};export{pe as default};
